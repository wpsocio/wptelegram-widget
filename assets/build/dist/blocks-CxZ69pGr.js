import{j as e,_ as o,a as D,u as z}from"./usePluginData-CBVYBKtd.js";const y=(t,n,s)=>{const a=n.filter(l=>t==null?void 0:t[l]).map(l=>`${l}="${t[l]}"`),i=a.length?` ${a.join(" ")}`:"";return`[${s} ${i}]`},O=["widget_width","widget_height","username"],R="wptelegram-ajax-widget",v=({attributes:t})=>e.jsx(e.Fragment,{children:y(t,O,R)});var k;const f=((k=window.wptelegram_widget)==null?void 0:k.savedSettings)||{},H=({attributes:t,setAttributes:n,className:s})=>{const{widget_width:a,widget_height:i,username:l}=t,g=wp.element.useCallback(r=>n({widget_width:r}),[n]),p=wp.element.useCallback(r=>n({widget_height:r}),[n]),u=wp.element.useCallback(r=>n({username:r==null?void 0:r.replace("@","")}),[n]);return e.jsxs(e.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsxs(wp.components.PanelBody,{title:o("Widget Options"),children:[e.jsx(wp.components.TextControl,{label:o("Username"),value:l,onChange:u,help:D("%s %s",o("Channel username."),o("Leave empty for default.")),placeholder:(f==null?void 0:f.username)||"WPTelegram"}),e.jsx(wp.components.TextControl,{label:o("Widget Width"),value:a,onChange:g}),e.jsx(wp.components.TextControl,{label:o("Widget Height"),value:i,onChange:p,type:"number"})]})}),e.jsxs("div",{className:s,children:[e.jsxs("label",{children:[e.jsx(wp.components.Dashicon,{icon:"shortcode"}),e.jsx("span",{children:o("Telegram Channel Ajax Feed")})]}),e.jsx("code",{className:"widget-shortcode",children:e.jsx(v,{attributes:t})})]})]})},V={username:{type:"string",default:""},widget_width:{type:"string",default:"100%"},widget_height:{type:"string",default:"600"}};wp.blocks.registerBlockType("wptelegram/widget-ajax-channel-feed",{title:o("Telegram Channel Ajax Feed"),icon:"format-aside",category:"wptelegram",attributes:V,edit:H,save:({attributes:t})=>e.jsx("div",{children:e.jsx(v,{attributes:t})})});const G=["author_photo","num_messages","widget_width"],M="wptelegram-widget",T=({attributes:t})=>e.jsx(e.Fragment,{children:y(t,G,M)}),Y=()=>[{label:"Auto",value:"auto"},{label:"Always show",value:"always_show"},{label:"Always hide",value:"always_hide"}],J=({attributes:t,setAttributes:n,className:s})=>{const{widget_width:a,author_photo:i,num_messages:l}=t,g=wp.element.useCallback(r=>n({author_photo:r}),[n]),p=wp.element.useCallback(r=>n({widget_width:r}),[n]),u=wp.element.useCallback(r=>n({num_messages:Number.parseInt(r)||5}),[n]);return e.jsxs(e.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsxs(wp.components.PanelBody,{title:o("Widget Options"),children:[e.jsx(wp.components.TextControl,{label:o("Widget Width"),value:a,onChange:p,type:"number",min:"10",max:"100"}),e.jsx(wp.components.RadioControl,{label:o("Author Photo"),selected:i,onChange:g,options:Y()}),e.jsx(wp.components.TextControl,{label:o("Number of Messages"),value:l,onChange:u,type:"number",min:"1",max:"50"})]})}),e.jsxs("div",{className:s,children:[e.jsxs("label",{children:[e.jsx(wp.components.Dashicon,{icon:"shortcode"}),e.jsx("span",{children:o("Telegram Channel Feed")})]}),e.jsx("code",{className:"widget-shortcode",children:e.jsx(T,{attributes:t})})]},"shortcode")]})},K={widget_width:{type:"string",default:"100"},author_photo:{type:"string",default:"auto"},num_messages:{type:"string",default:"5"}};wp.blocks.registerBlockType("wptelegram/widget-channel-feed",{title:o("Telegram Channel Feed"),icon:"format-aside",category:"wptelegram",attributes:K,edit:J,save:({attributes:t})=>e.jsx("div",{children:e.jsx(T,{attributes:t})})});const Q=t=>z("wptelegram_widget",t),Z=({setAttributes:t,attributes:n})=>{const{alignment:s,link:a,text:i}=n,{join_link_text:l,join_link_url:g}=Q("uiData");wp.element.useEffect(()=>{a||t({link:g}),i||t({text:l})},[]);const p=wp.element.useCallback(h=>t({link:h}),[t]),u=wp.element.useCallback(h=>t({text:h}),[t]),r=wp.element.useCallback(h=>t({alignment:h}),[t]);return e.jsxs(wp.element.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsxs(wp.components.PanelBody,{title:o("Button details"),children:[e.jsx(wp.components.TextControl,{label:o("Channel Link"),value:a||"",onChange:p,type:"url"}),e.jsx(wp.components.TextControl,{label:o("Button text"),value:i||"",onChange:u})]})},"controls"),e.jsx(wp.blockEditor.BlockControls,{children:e.jsx(wp.blockEditor.BlockAlignmentToolbar,{value:s,onChange:r})})]})},B=({fill:t="#ffffff"})=>e.jsx(wp.components.SVG,{width:"19px",height:"16px",viewBox:"0 0 19 16",children:e.jsx(wp.components.G,{fill:"none",children:e.jsx(wp.components.Path,{fill:t,d:"M0.465,6.638 L17.511,0.073 C18.078,-0.145 18.714,0.137 18.932,0.704 C19.009,0.903 19.026,1.121 18.981,1.33 L16.042,15.001 C15.896,15.679 15.228,16.111 14.549,15.965 C14.375,15.928 14.211,15.854 14.068,15.748 L8.223,11.443 C7.874,11.185 7.799,10.694 8.057,10.345 C8.082,10.311 8.109,10.279 8.139,10.249 L14.191,4.322 C14.315,4.201 14.317,4.002 14.195,3.878 C14.091,3.771 13.926,3.753 13.8,3.834 L5.602,9.138 C5.112,9.456 4.502,9.528 3.952,9.333 L0.486,8.112 C0.077,7.967 -0.138,7.519 0.007,7.11 C0.083,6.893 0.25,6.721 0.465,6.638 Z"})})}),q=({link:t,text:n,isEditing:s})=>e.jsx(wp.components.Button,{href:t,className:"join-link",icon:e.jsx(B,{}),target:s?"_blank":void 0,rel:"noopener noreferrer",children:n}),b={link:{type:"string"},text:{type:"string"},alignment:{type:"string",default:"center"}};wp.blocks.registerBlockType("wptelegram/widget-join-channel",{apiVersion:3,title:o("Join Telegram Channel"),icon:e.jsx(B,{fill:"#555d66"}),category:"wptelegram",attributes:b,getEditWrapperProps:t=>{const{alignment:n}=t;return["left","center","right","wide","full"].includes(n)?{"data-align":n}:{"data-align":""}},edit:({attributes:t,setAttributes:n})=>{const s=wp.blockEditor.useBlockProps({className:`align${t.alignment}`});return e.jsxs("div",{...s,children:[e.jsx(Z,{attributes:t,setAttributes:n}),e.jsx(q,{...t,isEditing:!0})]})},deprecated:[{attributes:b,save(){return null}}]});const X=t=>{const{userpic:n,toggleUserPic:s,showEditButton:a,switchBackToURLInput:i,alignment:l,changeAlignment:g}=t;return e.jsxs(wp.element.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsx(wp.components.PanelBody,{title:o("Options"),children:e.jsx(wp.components.ToggleControl,{label:o("Author Photo"),checked:n,onChange:s})})}),e.jsxs(wp.blockEditor.BlockControls,{children:[e.jsx(wp.blockEditor.BlockAlignmentToolbar,{value:l,onChange:g}),e.jsx(wp.components.ToolbarGroup,{children:a&&e.jsx(wp.components.ToolbarButton,{className:"components-toolbar__control",title:o("Edit URL"),icon:"edit",onClick:i})})]})]})},ee={border:"2px solid #f71717"},te=({error:t,label:n,onChangeURL:s,onSubmit:a,url:i})=>{const l=t?ee:void 0;return e.jsx(wp.components.Placeholder,{icon:"wordpress-alt",label:n,className:"wp-block-embed-telegram",children:e.jsxs("form",{onSubmit:a,children:[e.jsx("input",{"aria-label":n,className:"components-placeholder__input",onChange:s,placeholder:"https://t.me/WPTelegram/102",style:l,type:"url",value:i||""}),e.jsx(wp.components.Button,{type:"submit",children:o("Embed")})]})})},{message_view_url:ne}=window.wptelegram_widget.assets;function oe(t){const[n,s]=wp.element.useState("loading"),[a,i]=wp.element.useState(!1),[l,g]=wp.element.useState(t.attributes.url||""),[p,u]=wp.element.useState(t.attributes.userpic||!0),[r,h]=wp.element.useState(0),{className:E}=t,{alignment:P,iframe_src:C}=t.attributes,L=o("Telegram post URL");function $(c){g(c.target.value)}function N(c){c&&c.preventDefault();const w=/^(?:https?:\/\/)?t\.me\/(?<username>[a-z][a-z0-9_]{3,30}[a-z0-9])\/(?<message_id>\d+)$/i,m=l.match(w);if(m===null)s("error");else{const j=S(m.groups),{setAttributes:A}=t;s("loading"),i(!1),A({url:l,iframe_src:j})}}function S(c){return ne.replace("%username%",c.username).replace("%message_id%",c.message_id).replace("%userpic%",`${p}`)}function W(){u(c=>{const w=!c;s("loading");let{iframe_src:m}=t.attributes;return m=wp.url.addQueryArgs(m,{userpic:p}),t.setAttributes({userpic:w,iframe_src:m}),w})}function I(c){x(),t.setAttributes({alignment:c})}const d=wp.element.useRef(),F=wp.compose.useMergeRefs([d,wp.compose.useFocusableIframe()]);function x(){var w,m,j;if((d==null?void 0:d.current)===null||typeof((w=d==null?void 0:d.current)==null?void 0:w.contentWindow)>"u")return;const c=(j=(m=d==null?void 0:d.current)==null?void 0:m.contentWindow)==null?void 0:j.document.body.scrollHeight;c!==r&&h(c||0)}if(wp.element.useEffect(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[]),a||!C)return e.jsx(te,{label:L,error:n==="error",url:l,onChangeURL:$,onSubmit:N});const U=n==="loading"?0:r;return e.jsxs(wp.element.Fragment,{children:[e.jsx(X,{userpic:p,toggleUserPic:W,showEditButton:!0,switchBackToURLInput:()=>i(!0),alignment:P,changeAlignment:I}),n==="loading"&&e.jsxs("div",{className:"wp-block-embed is-loading",children:[e.jsx(wp.components.Spinner,{}),e.jsx("p",{children:o("Loadingâ€¦")})]}),e.jsx("div",{className:`${E} wptelegram-widget-message`,children:e.jsx("div",{className:"wp-block-embed__content-wrapper",children:e.jsx("iframe",{ref:F,src:C,onLoad:()=>{s("idle"),x()},height:U,title:o("Telegram post"),children:"Your Browser Does Not Support iframes!"})})})]})}const _={url:{type:"string",default:""},iframe_src:{type:"string",default:""},userpic:{type:"boolean",default:!0},alignment:{type:"string",default:"center"}};wp.blocks.registerBlockType("wptelegram/widget-single-post",{title:o("Telegram Single Post"),icon:"format-aside",category:"wptelegram",getEditWrapperProps:t=>{const{alignment:n}=t;return["left","center","right","wide","full"].includes(n)?{"data-align":n.toString()}:{"data-align":""}},attributes:_,edit:oe,save:({attributes:t})=>{const{alignment:n,iframe_src:s}=t;return e.jsx("div",{className:`wp-block-wptelegram-widget-single-post wptelegram-widget-message align${n}`,children:e.jsx("iframe",{title:o("Telegram post"),src:s,children:"Your Browser Does Not Support iframes!"})})},deprecated:[{attributes:_,save:({attributes:t})=>{const{alignment:n,iframe_src:s}=t;return e.jsx("div",{className:`wp-block-wptelegram-widget-single-post wptelegram-widget-message align${n}`,children:e.jsx("iframe",{src:s,title:o("Telegram post"),children:"Your Browser Does Not Support iframes!"})})}}]});
//# sourceMappingURL=blocks-CxZ69pGr.js.map

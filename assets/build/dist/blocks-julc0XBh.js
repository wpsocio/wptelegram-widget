import{j as e,_ as n,a as te,r as re,g as ne}from"./get-plugin-data-D3L8TS3p.js";import"./_commonjsHelpers-CqkleIqs.js";var k,S;function oe(){return S||(S=1,k=wp.blockEditor),k}var g=oe(),b,$;function se(){return $||($=1,b=wp.blocks),b}var v=se(),y,L;function ae(){return L||(L=1,y=wp.components),y}var o=ae(),B,D;function le(){return D||(D=1,B=wp.element),B}var a=le();const M=(t,r,s)=>{const d=r.filter(l=>t==null?void 0:t[l]).map(l=>`${l}="${t[l]}"`),u=d.length?` ${d.join(" ")}`:"";return`[${s} ${u}]`},ie=["widget_width","widget_height","username"],ce="wptelegram-ajax-widget",R=({attributes:t})=>e.jsx(e.Fragment,{children:M(t,ie,ce)});var q;const T=((q=window.wptelegram_widget)==null?void 0:q.savedSettings)||{},de=({attributes:t,setAttributes:r})=>{const{widget_width:s,widget_height:d,username:u}=t,l=a.useCallback(i=>r({widget_width:i}),[r]),_=a.useCallback(i=>r({widget_height:i}),[r]),h=a.useCallback(i=>r({username:i==null?void 0:i.replace("@","")}),[r]);return e.jsxs(e.Fragment,{children:[e.jsx(g.InspectorControls,{children:e.jsx(o.PanelBody,{title:n("Widget Options"),children:e.jsxs(o.Flex,{direction:"column",gap:4,children:[e.jsx(o.TextControl,{label:n("Username"),value:u,onChange:h,help:te.sprintf("%s %s",n("Channel username."),n("Leave empty for default.")),placeholder:(T==null?void 0:T.username)||"WPTelegram",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),e.jsx(o.TextControl,{label:n("Widget Width"),value:s,onChange:l,placeholder:`300 ${n("or")} 100%`,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),e.jsx(o.TextControl,{label:n("Widget Height"),value:d,onChange:_,placeholder:`300 ${n("or")} 100%`,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]})})}),e.jsxs("div",{...g.useBlockProps(),children:[e.jsxs("div",{className:"widget-label",children:[e.jsx(o.Dashicon,{icon:"shortcode"}),e.jsx("span",{children:n("Telegram Channel Ajax Feed")})]}),e.jsx("code",{className:"widget-shortcode",children:e.jsx(R,{attributes:t})})]})]})},ue={username:{type:"string",default:""},widget_width:{type:"string",default:"100%"},widget_height:{type:"string",default:"600"}};v.registerBlockType("wptelegram/widget-ajax-channel-feed",{apiVersion:3,title:n("Telegram Channel Ajax Feed"),icon:"format-aside",category:"wptelegram",attributes:ue,edit:de,save:({attributes:t})=>e.jsx("div",{...g.useBlockProps.save(),children:e.jsx(R,{attributes:t})})});const ge=["author_photo","num_messages","widget_width"],pe="wptelegram-widget",A=({attributes:t})=>e.jsx(e.Fragment,{children:M(t,ge,pe)}),he=()=>[{label:"Auto",value:"auto"},{label:"Always show",value:"always_show"},{label:"Always hide",value:"always_hide"}],me=({attributes:t,setAttributes:r})=>{const{widget_width:s,author_photo:d,num_messages:u}=t,l=a.useCallback(i=>r({author_photo:i}),[r]),_=a.useCallback(i=>r({widget_width:i}),[r]),h=a.useCallback(i=>r({num_messages:(Number.parseInt(i)||5).toString()}),[r]);return e.jsxs(e.Fragment,{children:[e.jsx(g.InspectorControls,{children:e.jsx(o.PanelBody,{title:n("Widget Options"),children:e.jsxs(o.Flex,{direction:"column",gap:4,children:[e.jsx(o.TextControl,{label:n("Widget Width"),value:s,onChange:_,placeholder:`300 ${n("or")} 100%`,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),e.jsx(o.RadioControl,{label:n("Author Photo"),selected:d,onChange:l,options:he()}),e.jsx(o.TextControl,{label:n("Number of Messages"),value:u,onChange:h,type:"number",min:"1",max:"50",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]})})}),re.createElement("div",{...g.useBlockProps(),key:"shortcode"},e.jsxs("div",{className:"widget-label",children:[e.jsx(o.Dashicon,{icon:"shortcode"}),e.jsx("span",{children:n("Telegram Channel Feed")})]}),e.jsx("code",{className:"widget-shortcode",children:e.jsx(A,{attributes:t})}))]})},_e={widget_width:{type:"string",default:"100"},author_photo:{type:"string",default:"auto"},num_messages:{type:"string",default:"5"}};v.registerBlockType("wptelegram/widget-channel-feed",{apiVersion:3,title:n("Telegram Channel Feed"),icon:"format-aside",category:"wptelegram",attributes:_e,edit:me,save:({attributes:t})=>e.jsx("div",{...g.useBlockProps.save(),children:e.jsx(A,{attributes:t})})});const xe=t=>ne("wptelegram_widget",t),we=({setAttributes:t,attributes:r})=>{const{alignment:s,link:d,text:u}=r,{join_link_text:l,join_link_url:_}=xe("uiData");a.useEffect(()=>{d||t({link:_}),u||t({text:l})},[]);const h=a.useCallback(x=>t({link:x}),[t]),i=a.useCallback(x=>t({text:x}),[t]),f=a.useCallback(x=>t({alignment:x}),[t]);return e.jsxs(a.Fragment,{children:[e.jsx(g.InspectorControls,{children:e.jsx(o.PanelBody,{title:n("Button details"),children:e.jsxs(o.Flex,{direction:"column",gap:4,children:[e.jsx(o.TextControl,{label:n("Channel Link"),value:d||"",onChange:h,type:"url",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),e.jsx(o.TextControl,{label:n("Button text"),value:u||"",onChange:i,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})]})})},"controls"),e.jsx(g.BlockControls,{children:e.jsx(g.BlockAlignmentToolbar,{value:s,onChange:f})})]})},U=({fill:t="#ffffff"})=>e.jsx(o.SVG,{width:"19px",height:"16px",viewBox:"0 0 19 16",children:e.jsx(o.G,{fill:"none",children:e.jsx(o.Path,{fill:t,d:"M0.465,6.638 L17.511,0.073 C18.078,-0.145 18.714,0.137 18.932,0.704 C19.009,0.903 19.026,1.121 18.981,1.33 L16.042,15.001 C15.896,15.679 15.228,16.111 14.549,15.965 C14.375,15.928 14.211,15.854 14.068,15.748 L8.223,11.443 C7.874,11.185 7.799,10.694 8.057,10.345 C8.082,10.311 8.109,10.279 8.139,10.249 L14.191,4.322 C14.315,4.201 14.317,4.002 14.195,3.878 C14.091,3.771 13.926,3.753 13.8,3.834 L5.602,9.138 C5.112,9.456 4.502,9.528 3.952,9.333 L0.486,8.112 C0.077,7.967 -0.138,7.519 0.007,7.11 C0.083,6.893 0.25,6.721 0.465,6.638 Z"})})}),fe=({link:t,text:r,isEditing:s})=>e.jsx(o.Button,{href:t,className:"join-link",icon:e.jsx(U,{}),target:s?"_blank":void 0,rel:"noopener noreferrer",children:r}),F={link:{type:"string"},text:{type:"string"},alignment:{type:"string",default:"center"}};v.registerBlockType("wptelegram/widget-join-channel",{apiVersion:3,title:n("Join Telegram Channel"),icon:e.jsx(U,{fill:"#555d66"}),category:"wptelegram",attributes:F,getEditWrapperProps:t=>{const{alignment:r}=t;return["left","center","right","wide","full"].includes(r)?{"data-align":r}:{"data-align":""}},edit:({attributes:t,setAttributes:r})=>{const s=g.useBlockProps({className:`align${t.alignment}`});return e.jsxs("div",{...s,children:[e.jsx(we,{attributes:t,setAttributes:r}),e.jsx(fe,{...t,isEditing:!0})]})},deprecated:[{attributes:F,save(){return null}}]});var E,W;function je(){return W||(W=1,E=wp.compose),E}var z=je(),N,H;function Ce(){return H||(H=1,N=wp.url),N}var ve=Ce();const ke=({userpic:t,toggleUserPic:r,showEditButton:s,switchBackToURLInput:d,alignment:u,changeAlignment:l})=>e.jsxs(a.Fragment,{children:[e.jsx(g.InspectorControls,{children:e.jsx(o.PanelBody,{title:n("Options"),children:e.jsx(o.ToggleControl,{label:n("Author Photo"),checked:t,onChange:r,__nextHasNoMarginBottom:!0})})}),e.jsxs(g.BlockControls,{children:[e.jsx(g.BlockAlignmentToolbar,{value:u,onChange:l}),e.jsx(o.ToolbarGroup,{children:s&&e.jsx(o.ToolbarButton,{className:"components-toolbar__control",title:n("Edit URL"),icon:"edit",onClick:d})})]})]}),be={border:"2px solid #f71717"},ye=({error:t,label:r,onChangeURL:s,onSubmit:d,url:u})=>{const l=t?be:void 0;return e.jsx(o.Placeholder,{icon:"wordpress-alt",label:r,className:"wp-block-embed-telegram",children:e.jsxs("form",{onSubmit:d,children:[e.jsx("input",{"aria-label":r,className:"components-placeholder__input",onChange:s,placeholder:"https://t.me/WPTelegram/102",style:l,type:"url",value:u||""}),e.jsx(o.Button,{type:"submit",children:n("Embed")})]})})},{message_view_url:Be}=window.wptelegram_widget.assets;function Te(t){const[r,s]=a.useState("loading"),[d,u]=a.useState(!1),[l,_]=a.useState(t.attributes.url||""),[h,i]=a.useState(t.attributes.userpic??!0),[f,x]=a.useState(0),{alignment:O,iframe_src:P}=t.attributes,V=n("Telegram post URL");function G(c){_(c.target.value)}function Y(c){c&&c.preventDefault();const m=/^(?:https?:\/\/)?t\.me\/(?<username>[a-z][a-z0-9_]{3,30}[a-z0-9])\/(?<message_id>\d+)$/i,w=l.match(m);if(w===null)s("error");else{const C=J(w.groups),{setAttributes:ee}=t;s("loading"),u(!1),ee({url:l,iframe_src:C})}}function J(c){return Be.replace("%username%",c.username).replace("%message_id%",c.message_id).replace("%userpic%",`${h}`)}function K(c){s("loading");let{iframe_src:m}=t.attributes;m=ve.addQueryArgs(m,{userpic:c}),t.setAttributes({userpic:c,iframe_src:m}),i(c)}function Q(c){j(),t.setAttributes({alignment:c})}const p=a.useRef(),Z=z.useMergeRefs([p,z.useFocusableIframe()]);function j(){var m,w,C;if((p==null?void 0:p.current)===null||typeof((m=p==null?void 0:p.current)==null?void 0:m.contentWindow)>"u")return;const c=(C=(w=p==null?void 0:p.current)==null?void 0:w.contentWindow)==null?void 0:C.document.body.scrollHeight;c!==f&&x(c||0)}if(a.useEffect(()=>(window.addEventListener("resize",j),()=>{window.removeEventListener("resize",j)}),[]),d||!P)return e.jsx(ye,{label:V,error:r==="error",url:l,onChangeURL:G,onSubmit:Y});const X=r==="loading"?0:f;return e.jsxs(a.Fragment,{children:[e.jsx(ke,{userpic:h,toggleUserPic:K,showEditButton:!0,switchBackToURLInput:()=>u(!0),alignment:O,changeAlignment:Q}),r==="loading"&&e.jsxs("div",{className:"wp-block-embed is-loading",children:[e.jsx(o.Spinner,{}),e.jsx("p",{children:n("Loadingâ€¦")})]}),e.jsx("div",{...g.useBlockProps(),className:`${g.useBlockProps().className} wptelegram-widget-message`,children:e.jsx("div",{className:"wp-block-embed__content-wrapper",children:e.jsx("iframe",{ref:Z,src:P,onLoad:()=>{s("idle"),j()},height:X,title:n("Telegram post"),children:"Your Browser Does Not Support iframes!"})})})]})}const I={url:{type:"string",default:""},iframe_src:{type:"string",default:""},userpic:{type:"boolean",default:!0},alignment:{type:"string",default:"center"}};v.registerBlockType("wptelegram/widget-single-post",{apiVersion:3,title:n("Telegram Single Post"),icon:"format-aside",category:"wptelegram",getEditWrapperProps:t=>{const{alignment:r}=t;return["left","center","right","wide","full"].includes(r)?{"data-align":r.toString()}:{"data-align":""}},attributes:I,edit:Te,save:({attributes:t})=>{const{alignment:r,iframe_src:s}=t;return e.jsx("div",{className:`wp-block-wptelegram-widget-single-post wptelegram-widget-message align${r}`,children:e.jsx("iframe",{title:n("Telegram post"),src:s,children:"Your Browser Does Not Support iframes!"})})},deprecated:[{attributes:I,save:({attributes:t})=>{const{alignment:r,iframe_src:s}=t;return e.jsx("div",{className:`wp-block-wptelegram-widget-single-post wptelegram-widget-message align${r}`,children:e.jsx("iframe",{src:s,title:n("Telegram post"),children:"Your Browser Does Not Support iframes!"})})}}]});
//# sourceMappingURL=blocks-julc0XBh.js.map

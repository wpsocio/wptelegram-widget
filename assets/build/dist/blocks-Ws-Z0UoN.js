var k=Object.defineProperty;var y=(t,s,n)=>s in t?k(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var m=(t,s,n)=>(y(t,typeof s!="symbol"?s+"":s,n),n);import{j as e,_ as o,a as v,u as T}from"./usePluginData-9VFBHapt.js";const x=(t,s,n)=>{const r=s.filter(l=>t==null?void 0:t[l]).map(l=>`${l}="${t[l]}"`),i=r.length?` ${r.join(" ")}`:"";return`[${n} ${i}]`},L=["widget_width","widget_height","username"],B="wptelegram-ajax-widget",j=({attributes:t})=>e.jsx(e.Fragment,{children:x(t,L,B)});var f;const g=((f=window.wptelegram_widget)==null?void 0:f.savedSettings)||{},U=({attributes:t,setAttributes:s,className:n})=>{const{widget_width:r,widget_height:i,username:l}=t,c=wp.element.useCallback(a=>s({widget_width:a}),[s]),h=wp.element.useCallback(a=>s({widget_height:a}),[s]),d=wp.element.useCallback(a=>s({username:a==null?void 0:a.replace("@","")}),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsxs(wp.components.PanelBody,{title:o("Widget Options"),children:[e.jsx(wp.components.TextControl,{label:o("Username"),value:l,onChange:d,help:v("%s %s",o("Channel username."),o("Leave empty for default.")),placeholder:(g==null?void 0:g.username)||"WPTelegram"}),e.jsx(wp.components.TextControl,{label:o("Widget Width"),value:r,onChange:c}),e.jsx(wp.components.TextControl,{label:o("Widget Height"),value:i,onChange:h,type:"number"})]})}),e.jsxs("div",{className:n,children:[e.jsxs("label",{children:[e.jsx(wp.components.Dashicon,{icon:"shortcode"}),e.jsx("span",{children:o("Telegram Channel Ajax Feed")})]}),e.jsx("code",{className:"widget-shortcode",children:e.jsx(j,{attributes:t})})]})]})},P={username:{type:"string",default:""},widget_width:{type:"string",default:"100%"},widget_height:{type:"string",default:"600"}};wp.blocks.registerBlockType("wptelegram/widget-ajax-channel-feed",{title:o("Telegram Channel Ajax Feed"),icon:"format-aside",category:"wptelegram",attributes:P,edit:U,save:({attributes:t})=>e.jsx("div",{children:e.jsx(j,{attributes:t})})});const I=["author_photo","num_messages","widget_width"],E="wptelegram-widget",C=({attributes:t})=>e.jsx(e.Fragment,{children:x(t,I,E)}),R=()=>[{label:"Auto",value:"auto"},{label:"Always show",value:"always_show"},{label:"Always hide",value:"always_hide"}],S=({attributes:t,setAttributes:s,className:n})=>{const{widget_width:r,author_photo:i,num_messages:l}=t,c=wp.element.useCallback(a=>s({author_photo:a}),[s]),h=wp.element.useCallback(a=>s({widget_width:a}),[s]),d=wp.element.useCallback(a=>s({num_messages:Number.parseInt(a)||5}),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsxs(wp.components.PanelBody,{title:o("Widget Options"),children:[e.jsx(wp.components.TextControl,{label:o("Widget Width"),value:r,onChange:h,type:"number",min:"10",max:"100"}),e.jsx(wp.components.RadioControl,{label:o("Author Photo"),selected:i,onChange:c,options:R()}),e.jsx(wp.components.TextControl,{label:o("Number of Messages"),value:l,onChange:d,type:"number",min:"1",max:"50"})]})}),e.jsxs("div",{className:n,children:[e.jsxs("label",{children:[e.jsx(wp.components.Dashicon,{icon:"shortcode"}),e.jsx("span",{children:o("Telegram Channel Feed")})]}),e.jsx("code",{className:"widget-shortcode",children:e.jsx(C,{attributes:t})})]},"shortcode")]})},$={widget_width:{type:"string",default:"100"},author_photo:{type:"string",default:"auto"},num_messages:{type:"string",default:"5"}};wp.blocks.registerBlockType("wptelegram/widget-channel-feed",{title:o("Telegram Channel Feed"),icon:"format-aside",category:"wptelegram",attributes:$,edit:S,save:({attributes:t})=>e.jsx("div",{children:e.jsx(C,{attributes:t})})});const N=t=>T("wptelegram_widget",t),W=({setAttributes:t,attributes:s})=>{const{alignment:n,link:r,text:i}=s,{join_link_text:l,join_link_url:c}=N("uiData");wp.element.useEffect(()=>{r||t({link:c}),i||t({text:l})},[]);const h=wp.element.useCallback(p=>t({link:p}),[t]),d=wp.element.useCallback(p=>t({text:p}),[t]),a=wp.element.useCallback(p=>t({alignment:p}),[t]);return e.jsxs(wp.element.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsxs(wp.components.PanelBody,{title:o("Button details"),children:[e.jsx(wp.components.TextControl,{label:o("Channel Link"),value:r||"",onChange:h,type:"url"}),e.jsx(wp.components.TextControl,{label:o("Button text"),value:i||"",onChange:d})]})},"controls"),e.jsx(wp.blockEditor.BlockControls,{children:e.jsx(wp.blockEditor.BlockAlignmentToolbar,{value:n,onChange:a})})]})},b=({fill:t="#ffffff"})=>e.jsx(wp.components.SVG,{width:"19px",height:"16px",viewBox:"0 0 19 16",children:e.jsx(wp.components.G,{fill:"none",children:e.jsx(wp.components.Path,{fill:t,d:"M0.465,6.638 L17.511,0.073 C18.078,-0.145 18.714,0.137 18.932,0.704 C19.009,0.903 19.026,1.121 18.981,1.33 L16.042,15.001 C15.896,15.679 15.228,16.111 14.549,15.965 C14.375,15.928 14.211,15.854 14.068,15.748 L8.223,11.443 C7.874,11.185 7.799,10.694 8.057,10.345 C8.082,10.311 8.109,10.279 8.139,10.249 L14.191,4.322 C14.315,4.201 14.317,4.002 14.195,3.878 C14.091,3.771 13.926,3.753 13.8,3.834 L5.602,9.138 C5.112,9.456 4.502,9.528 3.952,9.333 L0.486,8.112 C0.077,7.967 -0.138,7.519 0.007,7.11 C0.083,6.893 0.25,6.721 0.465,6.638 Z"})})}),O=({link:t,text:s,isEditing:n})=>e.jsx(wp.components.Button,{href:t,className:"join-link",icon:e.jsx(b,{}),target:n?"_blank":void 0,rel:"noopener noreferrer",children:s}),u={link:{type:"string"},text:{type:"string"},alignment:{type:"string",default:"center"}};wp.blocks.registerBlockType("wptelegram/widget-join-channel",{apiVersion:3,title:o("Join Telegram Channel"),icon:e.jsx(b,{fill:"#555d66"}),category:"wptelegram",attributes:u,getEditWrapperProps:t=>{const{alignment:s}=t;return["left","center","right","wide","full"].includes(s)?{"data-align":s}:{"data-align":""}},edit:({attributes:t,setAttributes:s})=>{const n=wp.blockEditor.useBlockProps({className:`align${t.alignment}`});return e.jsxs("div",{...n,children:[e.jsx(W,{attributes:t,setAttributes:s}),e.jsx(O,{...t,isEditing:!0})]})},deprecated:[{attributes:u,save(){return null}}]});const F=t=>{const{userpic:s,toggleUserPic:n,showEditButton:r,switchBackToURLInput:i,alignment:l,changeAlignment:c}=t;return e.jsxs(wp.element.Fragment,{children:[e.jsx(wp.blockEditor.InspectorControls,{children:e.jsx(wp.components.PanelBody,{title:o("Options"),children:e.jsx(wp.components.ToggleControl,{label:o("Author Photo"),checked:s,onChange:n})})}),e.jsxs(wp.blockEditor.BlockControls,{children:[e.jsx(wp.blockEditor.BlockAlignmentToolbar,{value:l,onChange:c}),e.jsx(wp.components.ToolbarGroup,{children:r&&e.jsx(wp.components.ToolbarButton,{className:"components-toolbar__control",title:o("Edit URL"),icon:"edit",onClick:i,placeholder:""})})]})]})},z={border:"2px solid #f71717"},A=({error:t,label:s,onChangeURL:n,onSubmit:r,url:i})=>{const l=t?z:void 0;return e.jsx(wp.components.Placeholder,{icon:"wordpress-alt",label:s,className:"wp-block-embed-telegram",children:e.jsxs("form",{onSubmit:r,children:[e.jsx("input",{"aria-label":s,className:"components-placeholder__input",onChange:n,placeholder:"https://t.me/WPTelegram/102",style:l,type:"url",value:i||""}),e.jsx(wp.components.Button,{type:"submit",children:o("Embed")})]})})},{message_view_url:D}=window.wptelegram_widget.assets;class G extends wp.element.Component{constructor(n){super(n);m(this,"iframe_ref");this.iframe_ref=wp.element.createRef(),this.switchBackToURLInput=this.switchBackToURLInput.bind(this),this.getIframeSrc=this.getIframeSrc.bind(this),this.toggleUserPic=this.toggleUserPic.bind(this),this.resizeIframe=this.resizeIframe.bind(this),this.setUrl=this.setUrl.bind(this),this.handleOnChangeURL=this.handleOnChangeURL.bind(this),this.handleOnChangeAlign=this.handleOnChangeAlign.bind(this),this.onLoad=this.onLoad.bind(this),this.state={loading:!0,editingURL:!1,error:!1,url:this.props.attributes.url||"",userpic:this.props.attributes.userpic||!0,iframe_height:0}}toggleUserPic(){const n=!this.state.userpic,r=!0;let{iframe_src:i}=this.props.attributes;i=wp.url.addQueryArgs(i,{userpic:n}),this.setState({userpic:n,loading:r}),this.props.setAttributes({userpic:n,iframe_src:i})}setUrl(n){n&&n.preventDefault();const{url:r}=this.state,i=/^(?:https?:\/\/)?t\.me\/(?<username>[a-z][a-z0-9_]{3,30}[a-z0-9])\/(?<message_id>\d+)$/i,l=r.match(i);if(l===null)this.setState({error:!0});else{const c=this.getIframeSrc(l.groups),{setAttributes:h}=this.props;this.setState({loading:!0,editingURL:!1,error:!1}),h({url:r,iframe_src:c})}}getIframeSrc(n){return D.replace("%username%",n.username).replace("%message_id%",n.message_id).replace("%userpic%",`${this.state.userpic}`)}switchBackToURLInput(){this.setState({editingURL:!0})}componentDidMount(){window.addEventListener("resize",this.resizeIframe)}componentWillUnmount(){window.removeEventListener("resize",this.resizeIframe)}resizeIframe(){var r,i,l,c;if(((r=this.iframe_ref)==null?void 0:r.current)===null||typeof this.iframe_ref.current.contentWindow>"u")return;const n=(c=(l=(i=this.iframe_ref)==null?void 0:i.current)==null?void 0:l.contentWindow)==null?void 0:c.document.body.scrollHeight;n!==this.state.iframe_height&&this.setState({iframe_height:n})}handleOnChangeURL(n){this.setState({url:n.target.value})}handleOnChangeAlign(n){this.resizeIframe(),this.props.setAttributes({alignment:n})}onLoad(){this.setState({loading:!1}),this.resizeIframe()}render(){const{loading:n,editingURL:r,url:i,error:l,userpic:c}=this.state,{className:h}=this.props,{alignment:d,iframe_src:a}=this.props.attributes,p=o("Telegram post URL");if(r||!a)return e.jsx(A,{label:p,error:l,url:i,onChangeURL:this.handleOnChangeURL,onSubmit:this.setUrl});const _=n?0:this.state.iframe_height;return e.jsxs(wp.element.Fragment,{children:[e.jsx(F,{userpic:c,toggleUserPic:this.toggleUserPic,showEditButton:!0,switchBackToURLInput:this.switchBackToURLInput,alignment:d,changeAlignment:this.handleOnChangeAlign}),n&&e.jsxs("div",{className:"wp-block-embed is-loading",children:[e.jsx(wp.components.Spinner,{}),e.jsx("p",{children:o("Loadingâ€¦")})]}),e.jsx("div",{className:`${h} wptelegram-widget-message`,children:e.jsx("div",{className:"wp-block-embed__content-wrapper",children:e.jsx(wp.components.FocusableIframe,{iframeRef:this.iframe_ref,src:a,onLoad:this.onLoad,height:_,title:o("Telegram post"),children:"Your Browser Does Not Support iframes!"})})})]})}}const w={url:{type:"string",default:""},iframe_src:{type:"string",default:""},userpic:{type:"boolean",default:!0},alignment:{type:"string",default:"center"}};wp.blocks.registerBlockType("wptelegram/widget-single-post",{title:o("Telegram Single Post"),icon:"format-aside",category:"wptelegram",getEditWrapperProps:t=>{const{alignment:s}=t;return["left","center","right","wide","full"].includes(s)?{"data-align":s.toString()}:{"data-align":""}},attributes:w,edit:G,save:({attributes:t})=>{const{alignment:s,iframe_src:n}=t;return e.jsx("div",{className:`wp-block-wptelegram-widget-single-post wptelegram-widget-message align${s}`,children:e.jsx("iframe",{title:o("Telegram post"),src:n,children:"Your Browser Does Not Support iframes!"})})},deprecated:[{attributes:w,save:({attributes:t})=>{const{alignment:s,iframe_src:n}=t;return e.jsx("div",{className:`wp-block-wptelegram-widget-single-post wptelegram-widget-message align${s}`,children:e.jsx("iframe",{src:n,title:o("Telegram post"),children:"Your Browser Does Not Support iframes!"})})}}]});
//# sourceMappingURL=blocks-Ws-Z0UoN.js.map
